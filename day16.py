test_input = """.|...p....
|.-.p.....
.....|-...
........|.
..........
.........p
..../.pp..
.-.-/..|..
.|....-|.p
..//.|...."""

actual_input = """p................p......-.........................../..............|.p..-.................-......../..........
..p................p...........|.|../......p......../../...........|.......p....../.......p....../............
|......|./......../..........|p.......|/..|...............................|...............|...................
...................p.-.............................../.......p.....p..............././.......p...........|....
................p......................|...|p............../........./...................p......./......./....
-......p/..p/../...............................................p....p........p...............-....p......-....
....p......-......................-..|...........................-.|...-..........p................./.........
.......|..........p....|/................................/........................-/.p...-/................../
..p...-..../......................p./..........|-/......p...............|...|.............................|...
p................................p....|...........|......................|..........|.............../........-
|..../......p.....p................../............../..p.....|..............................................-.
.p...........p.-....|.....-..|......|..............p.....p...-......./..................../p....|.../p........
...........|.......-..p...............p................................../...........................p........
.........-.................../...................../.-../.........|...p..........-..........p........|........
../...../../.|......-.....|p...../.......p......-.........-............./....................../..............
.-....../.............-...../...........p........-.......p...............-|......p.....|....p.................
......................./..............................p.....p...-................................./...........
./.....p.........p-..-...-..p...................p......./....|.|.-..........|......./.........................
.................................-...............p...../....../..p..-......................|..................
...p.................p...p............p-.....................p...........-..............................-.....
.....-....-|......p..../...........-.................../............-.................../............-....|...
.....-..p.....................-............/..../..........-.../..........................-.......p...........
..|..........................-................|-..-..............|....................../.....|......|........
.p...........................p......//.....-..-............/.....................................././........-
....../...p.......................p/.p.../.........p......................................-.....p......./.....
.....|........../..................................../....-....................|....p........-.........../../.
.............|....p...................................|.....|./..........|...........................-.|......
......................................./........./..................-.......|...............p..../....|.......
.../....//.p...............p.....|..|...-......|.......-|.../.-....-..p........p...../.....|..................
............./...................................|.............../.|...................-..........-...........
...../....|.................................................|........p...........................-....../.|...
...p.....p.....................|/.-....p.....|.|...--...../...p......................../.........|............
../...................../|................/......p...|..p|............-../........-............./......./.....
...............|...................p-.................p......-/.|......./.......-....../........../....-......
.-/-.....|...|......../...p.|........-....................p..-.......-.............................|.-/.p.....
................-......|.....p...--................./....-..|.../............./.....p........../.........|....
.................p...p...........|........................p...............././........|p......./.............-
......p....p..................................././...|..|...............-.....||..............................
..../|.p-............./././....../-./.-..........-...............-..p...........|................../..........
..........p.-....|....p.|...............p.......p.........p./.....|...|........|.........-.................|-.
.|.p......................p......-....-....-...............p.....-.p............./|-...-./....../.......-.....
.........p......../.|.-.../.-...............-..-.......|......p...p..|..................................../...
/./.......|.p.....................................-...-.|......-/...........-..................../.........p..
...-..p........-................p...|.|....../...............|................................................
.....................................-......p...-.../..p....|..................p.........................-....
-........|...........-...........|//................|.....-..........|..-....../p..|../..-....p..p....../.....
.|............../.p...................................p..|....|..p..............|................/...-.../-...
........./.......|.|.................................|p....p|........p........|........|.....................p
..p....../....|......../.......p|.............p........................./............/..../...............-...
.....-........-............/../....-...............-.../......../../..-...........p.....p.......-...-.......-.
........|...../-....-......p.............................-..|p.....p.....p-..............p.......|............
......................................../.......-..p..........p.............|....-.....p/........./.|.....|...
..............-...................-.-...-............../...../.....p./........./.-....................-.......
................|........../p..../......................-.......-............p.|..|......../.........p-.......
........|.........p..........................................-....||..-..p.................-....../..-.......p
.....p.............../..p./.........p|.p.....-|..-..|...../.............../.........-.........................
...|......................//......./..........-...................p......|...../......................|..|....
....p..................|..............p........p........../..-.......-...-|...p../...../........-........./...
...|p.|.......p...........p.-.................|.........p/-...............//.......p................-./......|
.........................-/...-./........./.p.|.......p...p.........p....................p.....-....-.........
......p..p....../.p........./..........-......./.-.............................pp.............................
....................../......p|../....................-.................../..............-..p|.../............
...........p.......|.|.......................|.....................p../........../.-.........|................
...................../.||..........-..../.....-.................|p............................................
..p...p.....-./..........|......-...../.....................................................|................p
....................-.p............|../..............|..pp...........|.....|....-../..........-.....-.........
............................./...............-.........................p...p.|...p.............|...-...|......
.............|.............................|...................|...................p.................../...../
...p.....p.....................-............................/..........|....|..p...........|.|................
........./.......-.p./........................../...........................................|../....../|..p...
....../.........................p...../..-...p................/...-........p....../../......|.................
......./.-.../..-..........|......................................-....p-/.-...........|....-..p...........-..
.....-...........||p...|.......|.................p........../-.............../................-...............
|.-.............p............p.....-|...././..................................-|........-/..........-.....|...
p...................p........./.p...|..........p.|......-....-.-.........p...............|.../-.........p.....
.........../...........|.........|........................|.......................|..-.......................|
..|..................-......-..................-..............................pp............-....|............
..........|..........p......................................p...................-..................|..........
...../.........|.......................................p..././...|p................/...................|......
........p.|....................pp......|..............................p....../.-/...p.......................-.
...........p.............|....p..|......../.....././|..../........p.....|.................p.........|...-.....
.....................p......./p......|............../...........-..........p..................pp...........p..
................................................p.../.....................-...../p|............p-.............
...........p...............-........p................p................./...|....p.....................p...../.
......p........|.....-....................p../..............-...............-..............-..................
.....-............|....................p......p..|.....././...../p.....|...p...............................-.-
........././......-.-..../....|..|../..................../...-......................-.......................|.
.................................//....|............-........../.../.......................p......-...........
................../................|...................................p......./...-............./............
..|.............../.....-................-..|-.........../.....................p/.........p.../.........|.....
.........................../|.../....-..p-...../................./..........................|...............p.
.....|.........../..p........../......./........-..............|............|......................-..........
....|......................................-..|.-../........................-..............p.........-........
.-......-....................-.................././.........................-...|-......................|.....
...-......./........../...........................-........p.........|......-...........-.-...................
..........-.|.|.....p..-..-...p-..../.................|..|..-.......p..................|...|.......-..........
p...........-|....-..........................p................................|.......|...p.......p-........./
./........./-.-............p...-p.-.......................................p-.......................p..........
........|..........pp.....p.-.../............-................|.............-.-..-.....p.......-.....p-.......
...................p.......|...../.-...............p.../......../................../............p...|.........
..p..........|........-.-.......|...../..../....-...........|............|................p/../.........../...
...............p..|./............................................................/............/...............
..p........|/.|......|.............p.............p.....................|.....p..........|......|..............
.............-......|......|p....................p...|..........pp.........|.|....../..../..........p.......p.
../..|..................-................................................//........|..../-..-/..../.p.........
..p............./..........-..|......./-............../....|...............|.....................|.....--p....
....-|.p..|....|............./..........p-.......|........|....|..-................................-./..pp...p
....|..p.......................p......./.-............................||....-...................p......./.....
.|-.......................-...........|..........p.../.......p......p....................-p./.................
...................................................|.....................|...................................."""


def new_move(beam,grid):
    new_position_list = []
    row,index,dir,type = beam

    hitpoint = (row+directions[dir][0],index+directions[dir][1])

    if hitpoint[0] > len(grid[0])-1 or hitpoint[0]<0 or hitpoint[1]>len(grid)-1 or hitpoint[1]<0:
        new_position_list.append((row,index,-3,type))
        return new_position_list
    newdir = {"|": [[1,3], [1], [1,3], [3]],
                              "-": [[0], [0,2], [2], [0,2]],
                              ".": [[0], [1], [2], [3]],
                              "p": [[1], [0], [3], [2]],
                              "/": [[3], [2], [1], [0]]}
    newdirection =newdir.get(grid[hitpoint[0]][hitpoint[1]])[dir]
   # print(f"Beam {beam} {hitpoint} and {newdir.get(grid[hitpoint[0]][hitpoint[1]])} in direction{dir}")

    for x in newdirection:
        newbeam = (row+directions[dir][0],index+directions[dir][1],x,grid[hitpoint[0]][hitpoint[1]])
        new_position_list.append(newbeam)
    return new_position_list


directions = [(0, 1),  #0 east
                          (1, 0),  #1 south
                          (0, -1),  #2 west
                          (-1, 0)]  #3 north
lines = actual_input.splitlines()
startdir = 1
startbeam = (0,0,startdir,'.')
grid = []
filled_grid=[]
## Make the grid
for line in lines:
    gridline =[]
    filled_gridline =[]
    for char in line:
        gridline.append(char)
        filled_gridline.append(char)
    grid.append(gridline)
    filled_grid.append(filled_gridline)
megabeamlist =[]
for i in range(len(lines[0])):
    beam= (-1,i,1,lines[0][i])
    newdirections = new_move(beam,grid)
    #print(newdirections)
    for x in newdirections:
        megabeamlist.append(x)
#print('----')
for i in range(len(lines)):
    beam= (i,-1,0,lines[i][0])

    newdirections = new_move(beam,grid)
    #print(newdirections)
    for x in newdirections:
        megabeamlist.append(x)
#print('----')
for i in range(len(lines)):
    beam= (i,len(lines[0]),2,lines[i][0])
    newdirections = new_move(beam,grid)
    #print(newdirections)
    for x in newdirections:
        megabeamlist.append(x)


for i in range(len(lines[0])):
    beam= (len(lines),i,3,lines[0][i])
    newdirections = new_move(beam,grid)
    #print(newdirections)
    for x in newdirections:
        megabeamlist.append(x)
print(megabeamlist)
largestnumber =0
k= len(megabeamlist)
j=0
for startbeam in megabeamlist:
    j+=1
    move_list =[]
    previous_move_list =[startbeam]
    beams = [startbeam]
    while len(beams)>0:
        for beam in beams:
           #print(beam)
           new_beams = new_move(beam,grid)
           move_list.extend(new_beams)

        beams =[]
        for x in move_list:
            row,index,dir,type = x
            if dir != -3:
                if type == '|' and x in previous_move_list:
                    pass
                elif type == '-' and x in previous_move_list:
                    pass
                else:
                    beams.append(x)

        previous_move_list.extend(beams)
        move_list=[]
        # print('-----')
        # for p in previous_move_list:
        #     filled_grid[p[0]][p[1]] ='#'
        # for p in filled_grid:
        #     print(p)

    total_boxes = []
    for p in previous_move_list:
        row,index,dir,type = p
        box = (row, index)
        if box not in total_boxes:
            total_boxes.append(box)

    if len( total_boxes) > largestnumber:
        largestnumber = len(total_boxes)
    print(f"{j} out of {k}")
print(largestnumber)
